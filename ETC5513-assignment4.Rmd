---
title: "Assignment 4"
author:
- familyname: Sarkar
  othernames: Arpan
  address: India
  email: "asar0035@student.monash.edu"
  correspondingauthor: true
  qualifications: Masters In Business Analytics (Student) 
- familyname: Cui
  othernames: Xinyi
  address: China
  email: "xcui0006@student.monash.edu"
  correspondingauthor: true
  qualifications: Masters In Business Analytics (Student) 
- familyname: Liu
  othernames: Yalong
  address: China
  email: "yliu0406@student.monash.edu"
  correspondingauthor: true
  qualifications:  Masters In Business Analytics (Student)
department: Business Growth Hackers\newline Arpan Sarkar &\newline Xinyi Cui &\newline Yalong Liu
organization: World Bank Group
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, eval = TRUE)
```

```{r loading-packages}
library(tidyverse)
library(plotly)
library(broom)
library(ggResidpanel)
library(kableExtra)
```

# Introduction
Road traffic accidents are a serious safety problem faced by all countries. Road traffic accidents are also the main cause of injuries and deaths, and are the tenth leading cause of all deaths in the world.

The causes of road traffic accidents are complex, involving factors such as people, vehicles, and roads. People are the most active factor affecting traffic safety. Because vehicles are driven by people, and roads are used by people. At the same time, according to the World Health Organization, road traffic injuries have become the main cause of death among young people. This shows the seriousness of the impact of road traffic on personal safety.

Our dataset comes from Data Gov Au which is the central source of Australian open government data. Our team selected several different data sets from government data to conduct research and analysis on road deaths in Australia with human factors. 
The main content includes changes in the trend of road deaths caused by festivals, and road safety issues under the influence of alcohol as any psychoactive substance and any drug.

Research question: 

1. Finding the trend of road fatalities in Australia and the comparison of fatalities on special holidays

2. What is the trend of drug tests conducted from 2010 to 2018 and which state has the maximum number of road fatalities due to drug consumption?

3. What is the trend of positive RBT conducted from 2008 to 2019 and the relationship between positive RBT and number of death?

# Finding the trend of road fatalities in Australia and the comparison of fatalities on special holidays (Yalong Liu)

```{r reading-data, echo = FALSE, message = FALSE, warning = FALSE}
crashes_raw <- read_csv("data/ardd_fatalcrashes_mar2021.csv" )
christmas_raw <- read_csv("data/australian_christmas_road_deaths.csv") 
easter_raw <- read.csv("data/australian_easter_road_deaths_2021.csv") 
```

## Trend
```{r crashes_tidy}
crashes_tidy <- crashes_raw %>%
  select(`Crash ID`, State, Year, Dayweek, `Number Fatalities`, 
         `Christmas Period`, `Easter Period`, `Day of week`, `Time of day`) %>%
  filter(Year <= "2020") %>%
  rename(States = State)

crashes_trend <- crashes_tidy %>%
  group_by(States, Year) %>%
  summarise(`Number Fatalities` = sum(`Number Fatalities`, na.rm = TRUE))

crashes_trend %>%
  ggplot(aes(x = Year, 
             y = `Number Fatalities`,
             color = States)) +
  geom_line(size = 1.5) +
  theme_linedraw() +
  theme(panel.grid.major.x = element_blank(), 
          axis.ticks.y = element_blank(),
          panel.border = element_blank()) +
  labs(title = "The trend of road fatalities across the Australian states",
       legend.position='dodge') +
  scale_color_brewer(palette = "Set2") +
  scale_x_continuous(breaks=seq(1989, 2020, 5))
  ggplotly()
```
  
In \@ref(fig:crashes_tidy):

- New South Wales has always been the state with the highest number of road deaths. 

- The reason of a sharp drop in the number of fatalities in New South Wales and Victoria from 1989 to 1992 is two states successively promulgated regulations on blood alcohol concentration of 0.05. 

- States in remote areas have far fewer fatalities than states with large concentrations of cities.

## Crashes & Fatalities

```{r crashe_c}
crashe_c <- crashes_tidy %>% 
  select(-`Number Fatalities`) %>% 
  group_by(States, Year) %>% 
  count()  %>% 
  rename(Crashes = n) %>% 
  mutate(Crashes = as.double(Crashes))

crashe_f <- crashes_tidy %>%
  group_by(States, Year) %>%
  summarise(Fatalities = sum(`Number Fatalities`, na.rm = TRUE))

cf <- left_join(crashe_c, crashe_f) %>%
  pivot_longer(cols = -c(States, Year), names_to = "Types", values_to = "Number")

cf %>%
  group_by(States, Year, Types) %>%
  ggplot(aes(x = Year,
                 y = Number,
                 group = Types,
                 fill = Types)) +
  geom_col() +
  facet_wrap(~States) +
  coord_flip() +
  labs(title = "Comparison of the number of crashes and fatalities in each state",
       legend.position='dodge') +
  scale_color_brewer(palette = "Set2") 
```
In \@ref(fig:crashe_c):

- There is no significant difference.

- More practical cases are that only one person died in a crash.

## Road fatalities in 2020

```{r ce_tidy}
ce_tidy <- left_join(christmas_raw, easter_raw, by = c("Year" = "Year", "Jurisdiction" = "Jurisdiction")) %>%
  rename(C = 	`National.x`, E = `National.y`,
         Christmas = `Count.x`, Easter = `Count.y`) %>%
  select(-c(C, E))

ce_count <- ce_tidy %>%
  pivot_longer(cols = c(Christmas, Easter),
               names_to = "Festival",
               values_to = "Count")

dfChristmas <- ce_count[which(ce_count$Festival == "Christmas"),] %>%
  select(-Festival) %>%
  rename(Christmas = Count)
dfEaster <- ce_count[which(ce_count$Festival == "Easter"),] %>%
    select(-Festival) %>%
  rename(Easter = Count)

ce_join <- left_join(dfChristmas, dfEaster) %>%
  filter(Year == "2020") %>%
  select(-Year)
  knitr::kable(
  ce_join, booktabs = TRUE,
  caption = "Road deaths per jurisdiction in 2020") %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```
  
In Table \@ref(tab:ce_tidy):
- The highest number is 9 in Christmas in Queensland. 

- In the states with more main cities, the number of deaths during the 12-day Christmas holiday is more than double the number during the five-day Easter holiday.
  
## Festivals & Ordinary days

```{r crashes_wkd}
crashes_wkd <- crashes_tidy %>%
  filter(`Christmas Period` == "No",
         `Easter Period` == "No",
         Year %in% c(2008:2020)) %>%
  select(Year, `Number Fatalities`) %>%
  rename("Weekday" = `Number Fatalities`) %>%
  group_by(Year) %>%
  summarise(Weekday = sum(Weekday, na.rm = TRUE))

ce <- ce_tidy %>%
  select(-Jurisdiction) %>%
  group_by(Year) %>%
  summarise(Christmas = sum(Christmas),
            Easter = sum(Easter))

all_total <- left_join(ce, crashes_wkd, by = "Year")

all_mean <- all_total %>%
  mutate(Christmas = round((Christmas/12), digits = 0),
         Easter = round((Easter/5), digits = 0),
         Weekday = round((Weekday/366), digits = 0))%>%
  pivot_longer(cols = -Year,
               names_to = "Types",
               values_to = "Count") 

all_mean %>%
  ggplot(aes(x = Year,
             y = Count,
             fill = Types)) +
  geom_col() +
  labs(title = "Comparison of the road fatalities between festivals and weekdays",
       y = "Number (per day)",
       legend.position='dodge') +
  scale_fill_brewer(palette = "Set2") +
  scale_x_continuous(breaks=seq(2008, 2020, 2))
  ggplotly()
```
  
  
# How different states and territory RBT results different from each other?



```{r loading-data, message=FALSE}
alcohol <- read.csv("data/bitre_enforcement_data-rbt.csv") %>% 
rename("Number_of_crash" = "Number.of.deaths.from.crashes.involving.a.driver.or.motorcycle.rider.with.a.blood.alcohol.concentration..BAC..above.the.legal.limit",
       "Number_of_death" = "Number.of.drivers.and.motorcycle.riders.killed.with.a.blood.alcohol.concentration..BAC..above.the.legal.limit")
```

```{r Overview-of-postiveRBT-by-state, fig.height=8, fig.width=12}
p1<- ggplot(alcohol, aes(x = Year, y = Positive.RBT, group = State))+
  geom_line(aes(color=State))+
  geom_point(aes(color=State)) +
  ggtitle("Overview of positive RBT") +
  theme_bw()
  
ggplotly(p1)
```

The graph above presents the positive RBT test result from 2008 to 2019 for each state in Australia. 
Some interesting findings from the graph:

- The highest positive RBT result was in 2010 **Queensland** of 33638 positive results. 

- Queensland and New South Wales are the two states having the highest number of positive RBT.

- In general, there is a decreasing trend for positive RBT over the years for all states and territories

- Tasmania and Australian Capital Territory remained low positive RBT from 2008 to 2019.



From the number of positive RBT result not really illustrates the , as it depends on the number of conducted RBT for each state. Therefore, the RBT ratio is calculated and been plotted as a line graph.
```{r RBT-ratio-by-state}
ratio <- alcohol %>% 
  mutate(RBT_ratio = Positive.RBT /RBT.conducted *100)  

p2<- ggplot(ratio, aes(x = Year, y = RBT_ratio, group = State))+
  geom_line(aes(color=State))+
  geom_point(aes(color=State)) +
  ggtitle("RBT ratio for each state and territory") +
  theme_bw()
  
ggplotly(p2)
```
The graph above illustrates the positive RBT ration for each state from 2008 to 2019.

It is interesting to see that Queensland is no longer the highest in this figure while the Northern Territory have the highest positive RBT ratio for the past 13 years. All other states and territories have a RBT ratio below 1.5 from 2015, whereas NT stayed 7.8 for 2015.

West Australia used to have the second highest RBT ratio in 2008, and it was the second lowest RBT ratio is 2019, it experienced a great improve.

A report released by the Menzies school of research stated that Northern Territory have the highest rates of alcohol consumption per capita in Australia


# Is there a relationship between number of death and positive RBT?
```{r linear-regression}
ratio <- na.omit(ratio) %>% 
  mutate(total_death = Number_of_death + Number_of_crash)

p3 <- ggplot(ratio, aes(x = total_death, y = Positive.RBT)) +
  geom_point()+
  geom_smooth(method = lm)

ggplotly(p3)
```

```{r echo=FALSE}
model <- lm( total_death ~ Positive.RBT, data = ratio)

glance(model) %>% 
  kable() %>% 
  kable_classic()
```
The table is the measures of fit of the model. 

- R.squared is 0.818 which is close to 1.

- Adjusted R.squared is 0.815 which is close to 1.

- Relative low AIC and BIC

Therefore, overall a good model

```{r echo=FALSE}
resid_panel(model, plots = "all")
```

- Residual plot shows the fluctuation of residuals are big as the dots of residuals are not around 0

- Q-Q plots shows the sample and theoretical quantiles not matched with each other, indicating they are not normal distribution. 

- Histogram and boxplots show there are many outliers in the residuals and the residuals are not normally distributed.



In conclusion, it is a moderate model according to the diagnostic plots and the fitness of the model. As there is only one dependent variable (postive RBT) in the model which is not enough to explain the independent variable (Number of road death).
