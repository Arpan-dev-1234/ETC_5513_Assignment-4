---
title: "Carbon Emissions Report"
author:
- familyname: Sarkar
  othernames: Arpan
  address: India
  email: asar0035@student.monash.edu
  correspondingauthor: true
  qualifications: Masters In Business Analytics (Student) 
- familyname: Cui
  othernames: Xinyi
  address: China
  email: xcui0006@student.monash.edu
  correspondingauthor: true
  qualifications: Masters In Business Analytics (Student) 
- familyname: Liu
  othernames: Yalong
  address: China
  email: yliu0406@student.monash.edu
  correspondingauthor: true
  qualifications:  Masters In Business Analytics (Student)
department: Business Growth Hackers\newline Arpan Sarkar &\newline Xinyi Cui &\newline Yalong Liu
organization: World Bank Group
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      messages = FALSE, 
                      warning = FALSE)
```

```{r echo = FALSE, include = FALSE, messages = FALSE, warning = FALSE}
library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
library(naniar)
library(plotly)
library(tinytex)
library(explore)
library(janitor)
library(dplyr)
library(rlang)
```

\section*{The trend of road fatalities in Australia and the comparison of fatalities on special holidays}

# Introduction

Australia ranks among the top ten in the world in terms of car ownership per capita. With the increasing number of vehicles, traffic accidents also gradually increase.This section will mainly focus on the human aspect. The data is from an Australian government data website. Taking the number of deaths caused by traffic accidents as the main data, explore the difference in the frequency of serious traffic accidents caused by citizens going out at different time nodes.

Research question: 

- What are the trends in the number of road deaths across the Australian states? 

- Are traffic deaths higher on special holidays than on ordinary days?

# Exploratory data analysis

```{r include = FALSE}
crashes_raw <- read_csv("data/ardd_fatalcrashes_mar2021.csv" )
christmas_raw <- read_csv("data/australian_christmas_road_deaths.csv") 
easter_raw <- read.csv("data/australian_easter_road_deaths_2021.csv") 
```

## The trend of road deaths across the Australian states

```{r crashes_tidy, fig.align = "center", fig.width = 6, fig.cap = "Trend of traffic fatalities"}
crashes_tidy <- crashes_raw %>%
  select(`Crash ID`, State, Year, Dayweek, `Number Fatalities`, 
         `Christmas Period`, `Easter Period`, `Day of week`, `Time of day`) %>%
  filter(Year <= "2020")

crashes_trend <- crashes_tidy %>%
  group_by(State, Year) %>%
  summarise(`Number Fatalities` = sum(`Number Fatalities`, na.rm = TRUE))

crashes_trend %>%
  ggplot(aes(x = Year, 
             y = `Number Fatalities`,
             group = State,
             color = State)) +
  geom_line(size = 1.5)
```

In \@ref(fig:crashes_tidy), New South Wales has always been the state with the highest number of road deaths. The reason of a sharp drop in the number of fatalities in New South Wales and Victoria from 1989 to 1992 is two states successively promulgated regulations on blood alcohol concentration of 0.05. States in remote areas have far fewer fatalities than states with large concentrations of cities.


```{r crashe_c}
crashe_c <- crashes_tidy %>% 
  select(-`Number Fatalities`) %>% 
  group_by(State, Year) %>% 
  count()  %>% 
  rename(`Number Crashes` = n) %>% 
  mutate(`Number Crashes` = as.double(`Number Crashes`))

crashe_f <- crashes_tidy %>%
  group_by(State, Year) %>%
  summarise(`Number Fatalities` = sum(`Number Fatalities`, na.rm = TRUE))

cf <- left_join(crashe_c, crashe_f) %>%
  pivot_longer(cols = -c(State, Year), names_to = "Types", values_to = "Number")

cf %>%
  group_by(State, Year, Types) %>%
  ggplot(aes(x = Year,
                 y = Number,
                 group = Types,
                 fill = Types)) +
  geom_col() +
  facet_wrap(~State) +
  coord_flip()
```

In \@ref(fig:crashe_c),there is no significant difference, which indicates that more practical cases are that only one person died in a crash.


```{r ce_tidy}
ce_tidy <- left_join(christmas_raw, easter_raw, by = c("Year" = "Year", "Jurisdiction" = "Jurisdiction")) %>%
  rename(C = 	`National.x`, E = `National.y`,
         Christmas = `Count.x`, Easter = `Count.y`) %>%
  select(-c(C, E))

ce_count <- ce_tidy %>%
  pivot_longer(cols = c(Christmas, Easter),
               names_to = "Festival",
               values_to = "Count")

dfChristmas <- ce_count[which(ce_count$Festival == "Christmas"),] %>%
  select(-Festival) %>%
  rename(Christmas = Count)
dfEaster <- ce_count[which(ce_count$Festival == "Easter"),] %>%
    select(-Festival) %>%
  rename(Easter = Count)

ce_join <- left_join(dfChristmas, dfEaster) %>%
  filter(Year == "2020") %>%
  select(-Year)
  knitr::kable(
  ce_join, booktabs = TRUE,
  caption = "Road deaths per jurisdiction in 2020") %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

In Table \@ref(tab:ce_tidy), The highest number is 9 in Christmas in Queensland. In the states with more main cities, the number of deaths during the 12-day Christmas holiday is more than double the number during the five-day Easter holiday.

```{r}
crashes_wkd <- crashes_tidy %>%
  filter(`Christmas Period` == "No",
         `Easter Period` == "No",
         Year %in% c(2008:2020)) %>%
  select(Year, `Number Fatalities`) %>%
  rename("Weekday" = `Number Fatalities`) %>%
  group_by(Year) %>%
  summarise(Weekday = sum(Weekday, na.rm = TRUE))

ce <- ce_tidy %>%
  select(-Jurisdiction) %>%
  group_by(Year) %>%
  summarise(Christmas = sum(Christmas),
            Easter = sum(Easter))

all_total <- left_join(ce, crashes_wkd, by = "Year")

all_mean <- all_total %>%
  mutate(Christmas = round((Christmas/12), digits = 0),
         Easter = round((Easter/5), digits = 0),
         Weekday = round((Weekday/366), digits = 0))%>%
  pivot_longer(cols = -Year,
               names_to = "Types",
               values_to = "Count") 

all_mean %>%
  ggplot(aes(x = Year,
             y = Count,
             color = Types)) +
  geom_line(size = 1.5) +
  geom_point(size = 4) +
  scale_x_continuous(breaks=seq(2008, 2020, 2))
  ggplotly()
```












